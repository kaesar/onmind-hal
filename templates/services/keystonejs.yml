name: KeystoneJS CMS
description: Modern headless CMS and GraphQL API
commands:
  install:
    - docker pull node:18-slim
  setup:
    - mkdir -p ~/wsdata/keystonejs
    - mkdir -p ~/wsdata/keystonejs-build
    - cp templates/dockerfiles/keystonejs.dockerfile ~/wsdata/keystonejs-build/Dockerfile
    - cp templates/dockerfiles/keystonejs-package.json ~/wsdata/keystonejs-build/package.json
    - cp templates/dockerfiles/keystonejs-keystone.ts ~/wsdata/keystonejs-build/keystone.ts
    - cp templates/dockerfiles/keystonejs-schema.ts ~/wsdata/keystonejs-build/schema.ts
    - cp templates/dockerfiles/keystonejs-auth.ts ~/wsdata/keystonejs-build/auth.ts
    - cd ~/wsdata/keystonejs-build && docker build -t keystonejs:latest .
  run: |-
    docker run \
          -d \
          --name keystonejs \
          --network {{NETWORK_NAME}} \
          -p 3000:3000 \
          -e DATABASE_URL=postgresql://root:{{STORAGE_PASSWORD}}@postgresql:5432/keystonejs \
          -v ~/wsdata/keystonejs:/app/data keystonejs:latest
variables:
  - NETWORK_NAME
  - STORAGE_PASSWORD
dependencies:
  - postgresql
